# Register Application: PRD & Specifications

**Document Version:** 1.2  
**Date:** June 6, 2025  
**Status:** Active  
**Sources:** Project codebase, `https://reserve.org`

## 1. Product Requirements Document (PRD)

### 1.1. Vision

To provide a decentralized, user-friendly, and secure web interface for interacting with the Reserve Protocol, empowering users to permissionlessly create, manage, and utilize next-generation on-chain financial products: **Index DTFs** and **Yield DTFs**.

### 1.2. Product Priority: Index DTFs

The current product focus is on **Index DTFs**. This new product line represents a powerful evolution of the Reserve Protocol, allowing for the creation of diverse, decentralized indexes. The Register UI should prioritize a seamless and intuitive user experience for discovering, managing, and governing these products.

### 1.3. Core Products & User Stories

#### 1.3.1. Index DTFs (Decentralized Token Folios)

- **Protocol Description:** Index DTFs are on-chain token portfolios, similar to traditional ETFs. Their governance is managed via a "vote locking" mechanism, allowing for flexible and incentivized participation.
- **User Stories:**
  - **US1.1:** As a DeFi User, I want to discover available Index DTFs, viewing their asset composition and performance to make informed investment decisions.
  - **US1.2:** As a DeFi User, I want to mint new shares of an Index DTF by providing the underlying assets or redeem shares back into the underlying assets.
  - **US1.3:** As a Governance Participant, I want to lock my designated governance tokens in a `LockVault` to vote on proposals for one or more Index DTFs and earn rewards for my participation.

#### 1.3.2. Yield DTFs (formerly RTokens)

- **Protocol Description:** Yield DTFs are asset-backed, yield-bearing currencies designed for stability. Their security is enhanced by RSR stakers who provide first-loss capital in exchange for a share of the DTF's revenue.
- **User Stories:**
  - **US2.1:** As a DeFi User, I want to browse available Yield DTFs and view their key metrics (e.g., APY, collateral assets) so I can acquire stable, yield-bearing currency.
  - **US2.2:** As an RSR Staker, I want to stake my RSR on a specific Yield DTF to help secure it and earn a share of its revenue.

---

## 2. Feature Specifications

### 2.1. Feature Spec: Index DTF Governance (Vote Locking)

- **Relevant Code:** `src/views/index-dtf/`, `src/hooks/use-vote-locking.ts` (inferred)
- **Core Concept:** Governance for Index DTFs is achieved by locking a pre-defined governance token (which can be any token, including RSR) in a smart contract called a `LockVault`. A single `LockVault` can govern multiple DTFs, allowing lockers to receive rewards from each DTF they help govern, thus incentivizing participation.
- **Functional Requirements:**
  1.  **Discover Vaults:** The UI must allow users to see available `LockVaults` and which DTFs they govern.
  2.  **Lock Tokens:** A user can select a `LockVault`, enter an amount of the designated governance token, and choose a lock duration. Longer lock durations grant more voting power.
  3.  **Vote on Proposals:** The UI must display active proposals for the DTFs a user's lock governs. Users can then cast votes with their accrued voting power.
  4.  **View & Claim Rewards:** A dashboard must show the user the governance rewards they are accruing from each individual DTF their lock governs. A "Claim" button facilitates the withdrawal of these rewards.
  5.  **Unlock Tokens:** After the chosen lock duration expires, users can withdraw their initial tokens.

### 2.2. Feature Spec: Yield DTF Security (RSR Staking)

- **Relevant Code:** `src/views/staking/`, `src/hooks/use-rsr-staking.ts` (inferred)
- **Core Concept:** This mechanism is specific to **Yield DTFs** and is primarily for **security and revenue sharing**. RSR stakers provide "first-loss capital" against collateral asset defaults. In return for taking on this risk, they receive a share of the revenue generated by the Yield DTF's collateral basket. Governance rights are a secondary benefit of this stake.
- **Functional Requirements:**
  1.  **Stake RSR:** A user stakes RSR on a specific Yield DTF and receives an `stRSR` token representing their position.
  2.  **View Position:** The UI must clearly display the user's staked amount and the current `stRSR`/RSR exchange rate. Rewards are reflected in the appreciation of this rate.
  3.  **Unstake RSR:** A user initiates an unstaking request, which is subject to a mandatory, governance-set **unstaking delay** (e.g., 7-30 days). The UI must clearly communicate this delay.

---

## 3. Technical & Architectural Specs

- **Framework:** React with Vite
- **Language:** TypeScript
- **State Management:** Jotai
- **Blockchain Interaction:** `wagmi` and `viem`
- **UI & Styling:** A component library built using `shadcn/ui` and styled with **TailwindCSS**. This is the single standard for all new UI development.
- **Conventions:** All code must adhere to the conventions established in the project rules, including `kebab-case` naming, `const` arrow functions, and encapsulation of all blockchain logic within custom hooks.
- **Security:** As defined in the Vite configuration, all server responses must include security headers (`X-Frame-Options`, `Strict-Transport-Security`, `Content-Security-Policy`) to prevent common web vulnerabilities.
